{"version":3,"file":"ng-open-cv.js.map","sources":["ng://ng-open-cv/lib/ng-open-cv.service.ts","ng://ng-open-cv/lib/ng-open-cv.module.ts"],"sourcesContent":["import { Inject, Injectable, InjectionToken } from '@angular/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\n\nimport { OpenCVLoadResult, OpenCVOptions } from './ng-open-cv.models';\n\n/*\nAngular modifification of the OpenCV utils script found at https://docs.opencv.org/master/utils.js\n*/\ndeclare var cv: any;\n\nexport const OPEN_CV_CONFIGURATION = new InjectionToken<OpenCVOptions>('Angular OpenCV Configuration Object');\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgOpenCVService {\n  errorOutput: HTMLElement;\n  src = null;\n  dstC1 = null;\n  dstC3 = null;\n  dstC4 = null;\n\n  stream: any;\n  video: any;\n  private isReady = new BehaviorSubject<OpenCVLoadResult>({\n    ready: false,\n    error: false,\n    loading: true\n  });\n  isReady$: Observable<OpenCVLoadResult> = this.isReady.asObservable();\n  onCameraStartedCallback: (a, b) => void;\n  OPENCV_URL = 'opencv.js';\n  DEFAULT_OPTIONS = {\n    scriptUrl: 'assets/opencv/asm/3.4/opencv.js',\n    wasmBinaryFile: 'wasm/3.4/opencv_js.wasm',\n    usingWasm: false,\n    locateFile: this.locateFile.bind(this),\n    onRuntimeInitialized: () => {}\n  };\n\n  constructor(@Inject(OPEN_CV_CONFIGURATION) options: OpenCVOptions) {\n    this.setScriptUrl(options.scriptUrl);\n    const opts = { ...this.DEFAULT_OPTIONS, options };\n    this.loadOpenCv(opts);\n  }\n\n  private locateFile(path, scriptDirectory): string {\n    if (path === 'opencv_js.wasm') {\n      return scriptDirectory + '/wasm/' + path;\n    } else {\n      return scriptDirectory + path;\n    }\n  }\n\n  setScriptUrl(url: string) {\n    this.OPENCV_URL = url;\n  }\n\n  loadOpenCv(options: OpenCVOptions) {\n    this.isReady.next({\n      ready: false,\n      error: false,\n      loading: true\n    });\n    window['Module'] = { ...options };\n    const script = document.createElement('script');\n    script.setAttribute('async', '');\n    script.setAttribute('type', 'text/javascript');\n    script.addEventListener('load', () => {\n      const onRuntimeInitializedCallback = () => {\n        if (options.onRuntimeInitialized) {\n          options.onRuntimeInitialized();\n        }\n        this.isReady.next({\n          ready: true,\n          error: false,\n          loading: false\n        });\n      };\n      cv.onRuntimeInitialized = onRuntimeInitializedCallback;\n    });\n    script.addEventListener('error', () => {\n      const err = this.printError('Failed to load ' + this.OPENCV_URL);\n      this.isReady.next({\n        ready: false,\n        error: true,\n        loading: false\n      });\n      this.isReady.error(err);\n    });\n    script.src = this.OPENCV_URL;\n    const node = document.getElementsByTagName('script')[0];\n    if (node) {\n      node.parentNode.insertBefore(script, node);\n    } else {\n      document.head.appendChild(script);\n    }\n  }\n\n  createFileFromUrl(path, url) {\n    const request = new XMLHttpRequest();\n    request.open('GET', url, true);\n    request.responseType = 'arraybuffer';\n    return new Observable(observer => {\n      const { next, error: catchError, complete } = observer;\n      request.onload = ev => {\n        if (request.readyState === 4) {\n          if (request.status === 200) {\n            const data = new Uint8Array(request.response);\n            cv.FS_createDataFile('/', path, data, true, false, false);\n            observer.next();\n            observer.complete();\n          } else {\n            this.printError('Failed to load ' + url + ' status: ' + request.status);\n            observer.error();\n          }\n        }\n      };\n      request.send();\n    });\n  }\n\n  loadImageToCanvas(imageUrl, canvasId: string): Observable<any> {\n    return Observable.create(observer => {\n      const canvas: HTMLCanvasElement = <HTMLCanvasElement>document.getElementById(canvasId);\n      const ctx = canvas.getContext('2d');\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.onload = () => {\n        canvas.width = img.width;\n        canvas.height = img.height;\n        ctx.drawImage(img, 0, 0, img.width, img.height);\n        observer.next();\n        observer.complete();\n      };\n      img.src = imageUrl;\n    });\n  }\n\n  loadImageToHTMLCanvas(imageUrl: string, canvas: HTMLCanvasElement): Observable<any> {\n    return Observable.create(observer => {\n      const ctx = canvas.getContext('2d');\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.onload = () => {\n        canvas.width = img.width;\n        canvas.height = img.height;\n        ctx.drawImage(img, 0, 0, img.width, img.height);\n        observer.next();\n        observer.complete();\n      };\n      img.src = imageUrl;\n    });\n  }\n\n  clearError() {\n    this.errorOutput.innerHTML = '';\n  }\n\n  printError(err) {\n    if (typeof err === 'undefined') {\n      err = '';\n    } else if (typeof err === 'number') {\n      if (!isNaN(err)) {\n        if (typeof cv !== 'undefined') {\n          err = 'Exception: ' + cv.exceptionFromPtr(err).msg;\n        }\n      }\n    } else if (typeof err === 'string') {\n      const ptr = Number(err.split(' ')[0]);\n      if (!isNaN(ptr)) {\n        if (typeof cv !== 'undefined') {\n          err = 'Exception: ' + cv.exceptionFromPtr(ptr).msg;\n        }\n      }\n    } else if (err instanceof Error) {\n      err = err.stack.replace(/\\n/g, '<br>');\n    }\n    throw new Error(err);\n  }\n\n  loadCode(scriptId, textAreaId) {\n    const scriptNode = <HTMLScriptElement>document.getElementById(scriptId);\n    const textArea = <HTMLTextAreaElement>document.getElementById(textAreaId);\n    if (scriptNode.type !== 'text/code-snippet') {\n      throw Error('Unknown code snippet type');\n    }\n    textArea.value = scriptNode.text.replace(/^\\n/, '');\n  }\n\n  addFileInputHandler(fileInputId, canvasId) {\n    const inputElement = document.getElementById(fileInputId);\n    inputElement.addEventListener(\n      'change',\n      e => {\n        const files = e.target['files'];\n        if (files.length > 0) {\n          const imgUrl = URL.createObjectURL(files[0]);\n          this.loadImageToCanvas(imgUrl, canvasId);\n        }\n      },\n      false\n    );\n  }\n\n  onVideoCanPlay() {\n    if (this.onCameraStartedCallback) {\n      this.onCameraStartedCallback(this.stream, this.video);\n    }\n  }\n\n  startCamera(resolution, callback, videoId) {\n    const constraints = {\n      qvga: { width: { exact: 320 }, height: { exact: 240 } },\n      vga: { width: { exact: 640 }, height: { exact: 480 } }\n    };\n    let video = <HTMLVideoElement>document.getElementById(videoId);\n    if (!video) {\n      video = document.createElement('video');\n    }\n\n    let videoConstraint = constraints[resolution];\n    if (!videoConstraint) {\n      videoConstraint = true;\n    }\n\n    navigator.mediaDevices\n      .getUserMedia({ video: videoConstraint, audio: false })\n      .then(stream => {\n        video.srcObject = stream;\n        video.play();\n        this.video = video;\n        this.stream = stream;\n        this.onCameraStartedCallback = callback;\n        video.addEventListener('canplay', this.onVideoCanPlay.bind(this), false);\n      })\n      .catch(err => {\n        this.printError('Camera Error: ' + err.name + ' ' + err.message);\n      });\n  }\n\n  stopCamera() {\n    if (this.video) {\n      this.video.pause();\n      this.video.srcObject = null;\n      this.video.removeEventListener('canplay', this.onVideoCanPlay.bind(this));\n    }\n    if (this.stream) {\n      this.stream.getVideoTracks()[0].stop();\n    }\n  }\n\n  getContours(src, width, height) {\n    cv.cvtColor(src, this.dstC1, cv.COLOR_RGBA2GRAY);\n    cv.threshold(this.dstC1, this.dstC4, 120, 200, cv.THRESH_BINARY);\n    const contours = new cv.MatVector();\n    const hierarchy = new cv.Mat();\n    cv.findContours(this.dstC4, contours, hierarchy, cv.RETR_CCOMP, cv.CHAIN_APPROX_SIMPLE, {\n      x: 0,\n      y: 0\n    });\n    this.dstC3.delete();\n    this.dstC3 = cv.Mat.ones(height, width, cv.CV_8UC3);\n    for (let i = 0; i < contours.size(); ++i) {\n      const color = new cv.Scalar(0, 255, 0);\n      cv.drawContours(this.dstC3, contours, i, color, 1, cv.LINE_8, hierarchy);\n    }\n    contours.delete();\n    hierarchy.delete();\n    return this.dstC3;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { NgOpenCVService, OPEN_CV_CONFIGURATION } from './ng-open-cv.service';\nimport { OpenCVOptions } from './ng-open-cv.models';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [],\n  providers: [NgOpenCVService]\n})\nexport class NgOpenCVModule {\n  /**\n   *\n   * Setup the module in your application's root bootstrap.\n   *\n   *\n   * @memberOf NgOpenCvModule\n   */\n  static forRoot(config: OpenCVOptions): ModuleWithProviders {\n    return {\n      ngModule: NgOpenCVModule,\n      providers: [{ provide: OPEN_CV_CONFIGURATION, useValue: config }]\n    };\n  }\n}\n"],"names":[],"mappings":"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"}
